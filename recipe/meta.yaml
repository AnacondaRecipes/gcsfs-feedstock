{% set name = "gcsfs" %}
{% set version = "2025.10.0" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  url: https://pypi.org/packages/source/{{ name[0] }}/{{ name }}/{{ name }}-{{ version }}.tar.gz
  sha256: 7ac9b16a145bcb1a69fa9cf770ccd3cee7b9a09236911dd586c1d9911b71583d

build:
  number: 1
  script: {{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation
  skip: True  # [py<39]

requirements:
  host:
    - python
    - pip
    - wheel
    - setuptools
  run:
    - python
    - aiohttp !=4.0.0a0,!=4.0.0a1
    - decorator >4.1.2
    - fsspec =={{ version }}
    - google-auth >=1.2
    - google-auth-oauthlib
    - google-cloud-storage
    - requests

# Ignore tests which trying to use docker
#   > raise CalledProcessError(retcode, process.args, output=stdout, stderr=stderr)
#   E subprocess.CalledProcessError: Command '['docker', 'ps', '-a', '-q', '--filter', 'name=gcsfs_test']' returned non-zero exit status 1.
{% set ignore_tests = " --ignore=gcsfs/tests/test_core.py" %}
{% set ignore_tests = ignore_tests + " --ignore=gcsfs/tests/derived" %}
{% set deselect_tests = " --deselect=gcsfs/tests/test_inventory_report_listing.py::test_ls_base" %}
{% set deselect_tests = deselect_tests + " --deselect=gcsfs/tests/test_mapping.py::test_map_simple" %}
{% set deselect_tests = deselect_tests + " --deselect=gcsfs/tests/test_mapping.py::test_map_default_gcsfilesystem" %}
{% set deselect_tests = deselect_tests + " --deselect=gcsfs/tests/test_mapping.py::test_map_errors" %}
{% set deselect_tests = deselect_tests + " --deselect=gcsfs/tests/test_mapping.py::test_map_with_data" %}
{% set deselect_tests = deselect_tests + " --deselect=gcsfs/tests/test_mapping.py::test_map_clear_empty" %}
{% set deselect_tests = deselect_tests + " --deselect=gcsfs/tests/test_mapping.py::test_map_pickle" %}
{% set deselect_tests = deselect_tests + " --deselect=gcsfs/tests/test_mapping.py::test_map_array" %}
{% set deselect_tests = deselect_tests + " --deselect=gcsfs/tests/test_mapping.py::test_map_bytearray" %}
{% set deselect_tests = deselect_tests + " --deselect=gcsfs/tests/test_mapping.py::test_new_bucket" %}
{% set deselect_tests = deselect_tests + " --deselect=gcsfs/tests/test_retry.py::test_metadata_read_permissions" %}

test:
  source_files:
    - gcsfs
  imports:
    - gcsfs
    - gcsfs.checkers
    - gcsfs.core
    - gcsfs.credentials
    - gcsfs.inventory_report
    - gcsfs.retry
  commands:
    - pip check
    # Unable to use the "pyargs", tests are not in the site-packages directory.
    - pytest -v gcsfs/tests --asyncio-mode=auto {{ ignore_tests }} {{ deselect_tests }}
  requires:
    - pip
    - pytest
    - pytest-asyncio

about:
  home: https://github.com/dask/gcsfs
  license: BSD-3-Clause
  license_file: LICENSE.txt
  license_family: BSD
  summary: Pythonic file-system interface for Google Cloud Storage
  doc_url: https://gcsfs.readthedocs.io
  dev_url: https://github.com/fsspec/gcsfs
  description: A pythonic file-system interface to Google Cloud Storage.

extra:
  recipe-maintainers:
    - martindurant
    - jcrist
    - tomaugspurger
